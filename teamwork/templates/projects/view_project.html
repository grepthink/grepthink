{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{# Clear out javascript block at bottom of page so we can import specific js #}
{% block javascript %}
<script src="{% static 'js/jquery-2.2.3.min.js' %}"></script>

<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>

<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
    $.widget.bridge('uibutton', $.ui.button);
</script>

<script src="{% static 'js/bootstrap.min.js' %}"></script>

<script src="{% static 'js/app.min.js' %}"></script>

<!-- Slimscroll -->
<script src="{% static 'js/jquery.slimscroll.min.js' %}"></script>

<script src="{% static 'js/fastclick.js' %}"></script>

<script src="{% static 'js/moment.min.js' %}"></script>

<script src="{% static 'js/fullcalendar.min.js' %}"></script>

<script src="{% static 'js/schedule.js' %}"></script>


{% endblock javascript %}

{% block stylesheets %}

  {{ block.super }}

  <!-- fullCalendar 2.2.5-->
  <link rel="stylesheet" href="{% static 'css/fullcalendar.min.css' %}">
  <link rel="stylesheet" href="{% static 'css/fullcalendar.print.css' %}" media="print">
  <link rel="stylesheet" href="{% static 'css/Scrollbar.css' %}">
  <link rel="stylesheet" href="{% static 'css/Tooltip.css' %}">

{% endblock stylesheets %}


{# Add the breadcrumbs for this page #}
{% block crumb %}

{# Breadcrumb for the course that this project is in #}
<li><a href="{% url 'view_one_course' course.slug %}"> {{course.name}} </a></li>

{# Breadcrumb for this project #}
<li><a href="{% url 'view_one_project' project.slug %}"> {{project.title}} </a></li>

{% endblock crumb %}


{% block content %}

<div>
    <!-- Custom Tabs -->
    <div class="nav-tabs-custom">
        <ul class="nav nav-tabs">
            <li class="active"><a href="#tab_1" data-toggle="tab" aria-expanded="true">Description</a></li>
            <li class=""><a href="#tab_2" data-toggle="tab" aria-expanded="false">Updates</a></li>
            <li class=""><a href="#tab_3" data-toggle="tab" aria-expanded="false">Resources</a></li>
            {% if user in project_members %}
            <li class=""><a href="#tab_5" data-toggle="tab"
                aria-expanded="false">TSR</a></li>
            {% endif %}
            {% if request.user in staff or request.user.profile.isGT %}
            <li class=""><a href="#tab_6" data-toggle="tab" aria-expanded="false">View TSR</a></li>
            {% endif %}


            <!-- Graphical Analysis Tab-->
            {% if request.user in staff or request.user.profile.isGT %}
            <li class=""><a href="#tab_9" data-toggle="tab" aria-expanded="false">Graphical Analysis</a></li>
            {% endif %}
            <!-- Graphical Analysis Tab-->


            {% if user in project_members %}
            <li class=""><a href="#tab_7" data-toggle="tab" aria-expanded="false">Chat</a></li>
            {% endif %}
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                    Project Tools <span class="caret"></span>
                </a>
                <ul class="dropdown-menu">
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="{% url 'edit_project' project.slug %}">Edit</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="{% url 'post_update' project.slug %}">Post Update</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="{% url 'resource_update' project.slug %}">Add Resource</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="{% url 'view_meetings' project.slug %}">Meeting Times </a></li>

                    {% if user in project_members %}
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="{% url 'leave_project' project.slug %}">Leave Project </a></li>
                    {% endif %}

                </ul>
            </li>

            <!-- COGWHEEL -->

            <li class="pull-right"><a href="{% url 'edit_project' project.slug %}" class="text-muted"><i class="fa fa-gear"></i></a></li>

            <!-- EMAIL STUDENTS IN PROJECT -->
            {% if request.user in staff %}
            <li class="pull-right">
            <a href="{% url 'email_project' project.slug %}">
                Email Project Members
            </a>
            </li>
            {% endif %}
            <!-- REQUEST TO JOIN PROJECT BUTTON -->

            {% if not request.user in staff %}
            {% if not user in project.members.all %}
            {% if requestButton %}
            <li class="pull-right">
            <a href="{% url 'request_to_join' project.slug %}">
                Request To Join Project
                <i class="fa fa-plus"></i>
            </a>
            </li>
            {% else %}
            <li class="pull-right">
            <a href="{% url 'request_to_join' project.slug %}">
                Cancel Your Request to Join
                <i class="fa fa-undo"></i>
            </a>
            </li>
            {% endif %}
            {% endif %}
            {% endif %}


        </ul>

        <div class="tab-content">
            <!-- TAB 1 -->
            <div class="tab-pane active" id="tab_1">
                <div class="content">
                    {{ project.get_content_as_markdown|safe }}
                </div>
                <div>
                    <div class="box box-success collapsed-box">
                        <div class="box-header with-border">
                            <strong>Project Owner</strong>
                            &nbsp;
                            <a href="{% url 'profile' project_owner.user.username %}">
                            {% if project_owner.isGT %}
                                <span class="label label-success">
                            {% elif project_owner.isProf %}
                                <span class="label label-warning">
                            {% else %}
                                <span class="label label-info">
                            {% endif %}
                                {{ project.creator.username }}
                            </span></a>
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <strong>Desired Skills</strong>
                            &nbsp;
                            {% if project.desired_skills != none %}
                            {% for skill in project.desired_skills.all %}
                            <span class="label label-warning">
                                {{ skill.skill }}
                            </span>
                            &nbsp;
                            {% endfor %}
                            {% endif %}
                            <div class="box-tools pull-right">
                                <button type="button" class="btn btn-box-tool" data-widget="collapse">More Info</button>
                            </div>
                            <!-- /.box-tools -->
                        </div>
                        <!-- /.box-header -->
                        <div class="box-body" style="display: none;">
                            <strong>Teacher Assistant</strong>
                            &nbsp;
                            <a href="{% url 'profile' project.ta.username %}">
                                <span class="label label-info">
                                    {{ project.ta.username }}
                                </span>
                            </a>
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <strong>Members</strong>
                            &nbsp;
                            {% for mem in project.members.all %}
                            {% if mem.username != null %}
                            <a href="{% url 'profile' mem.username %}">
                            <span class="label label-primary">
                                {{ mem.username }}
                            </span>
                            </a>
                            &nbsp;
                            {% endif %}
                            {% endfor %}
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <strong>Scrum Master</strong>
                            &nbsp;
                            <a href="{% url 'profile' project.scrum_master.username %}">
                                <span class="label label-info">
                                    {{ project.scrum_master.username }}
                                </span>
                            </a>
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <strong>Meeting Location</strong>
                            &nbsp;
                            {% if project.ta_location == "" %}
                                N/A
                            {% else %}
                                {{ project.ta_location }}
                            {% endif %}
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <strong>Meeting Time</strong>
                            &nbsp;
                            {% if project.ta_time == "" %}
                                N/A
                            {% else%}
                                {{ project.ta_time }}
                            {% endif %}
                        </div>
                        <!-- /.box-body -->
                    </div>
                </div>
            </div>

            <!-- TAB 2 - Updates -->
            <div class="tab-pane" id="tab_2">

                <h3>Updates</h3>
                <ul class="timeline">
                    <!-- timeline time label -->
                    <li class="time-label" style="list-style: none">
                        <span class="bg-red">
                            {{project.title}}
                        </span>
                    </li>
                    <!-- /.timeline-label -->
                    {% if user in project.members.all or user == project.creator or user.profile.isGT%}
                    <li style="list-style: none"
                        onclick="window.location =
                        '{% url 'post_update' project.slug %}'">
                        <i class="fa fa-plus bg-green"></i>
                        <div class="timeline-item"
                            style="background-color: #ffffff">
                            <div class="timeline-header">
                                Add an update
                            </div>
                        </div>
                    </li>
                    {% endif %}

                    {% for up in updates.all %}
                    <li style="list-style: none">
                        <i class="fa fa-comments bg-blue"></i>
                        <div class="timeline-item">
                            <div class="timeline-header clearfix">
                                {{up.update_title}}
                            </div>
                            <div class="timeline-body">
                                {{up.update}}
                            </div>
                            <div class="timeline-footer clearfix">
                                <span class="label label-primary"
                                    onclick="window.location =
                                    '{% url 'profile' up.user.username %}'">
                                    {{up.user.username}}
                                </span>
                                <i class="pull-right">
                                    Posted {{up.date}}
                                </i>
                            </div>
                        </div>
                    </li>

                    {% empty %}
                    <li style="list-style: none">
                        <i class="fa fa-times bg-red"></i>
                        <div class="timeline-item"
                            style="background-color: #ffffff">
                            <div class="timeline-header">
                                There are no updates
                            </div>
                        </div>
                    </li>
                    {% endfor %}
                    <li style="list-style: none">
                        <i class="fa fa-clock-o"></i>
                    </li>
                </ul>



                {% comment %}
                <!-- row -->
                <div class="row">
                    <div class="col-md-12">
                        <!-- The time line -->
                        <ul class="timeline">
                            <!-- timeline time label -->
                            <li class="time-label" style="list-style: none">
                                <span class="bg-red">
                                    {{project.title}}
                                </span>
                            </li>
                            <!-- /.timeline-label -->
                            <!-- timeline item -->
                            {% for up in updates.all %}
                            {% if up.update_title != null %}
                            <li style="list-style: none">
                                <i class="fa fa-envelope bg-blue"></i>

                                <div class="timeline-item">
                                    <span class="time"><i class="fa fa-clock-o"></i> {{up.date}} </span>

                                    <h3 class="timeline-header">{{up.update_title}}</h3>

                                    <div class="timeline-body">
                                        {{up.update}}
                                    </div>
                                    <div class="timeline-footer">
                                        <a class="btn btn-primary btn-xs">{{up.user.username}}</a>
                                        <a class="btn btn-danger btn-xs">{{project.title}}</a>
                                    </div>
                                </div>
                            </li>
                            <!-- END timeline item -->
                            {% endif %}
                            {% endfor %}

                            <li style="list-style: none">
                                <i class="fa fa-clock-o bg-gray"></i>
                            </li>
                        </ul>
                    </div>
                    <!-- /.col -->
                </div>
                <!-- /.row -->
                {% endcomment %}
            </div>
            <!-- /.tab-pane End Updates -->

            <!-- /.tab-pane Resources -->
            <div class="tab-pane" id="tab_3">
                <div class="row">
                    <div class="col-md-12">
                    <h3 class="box-title">Resources</h3>
                        <div class="box-body no-padding">
                            <table class="table table-striped">
                                <tbody>
                                    <tr>
                                        <th>Resource Title</th>
                                        <th>URL Link</th>
                                        <th>Posted By</th>
                                        <th>Posted On</th>
                                    </tr>
                                    {% for re in resources.all %}
                                    {% if re.src_title != null %}
                                    <tr>
                                        <td>{{re.src_title}}</td>
                                        <td><a href="{{re.src_link}}">{{re.src_link}}</a></td>
                                        <td>{{re.user.username}}</td>
                                        <td>{{re.date}}</td>
                                    </tr>
                                    {% endif %}
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% if request.user in project.members.all %}
                            <a href="{% url 'resource_update' project.slug %}"
                                class="pull-right" style="padding-top: 10px">
                                <button class="btn btn-info">
                                    <i class="fa fa-book"></i>
                                    Post Resource
                                </button>
                            </a>
                        {% endif %}
                    </div>
                </div>
            </div>
            <!-- /.tab-pane End Resources -->

            <!-- /.tab-pane request meeting -->
            <div class="tab-pane" id="tab_4">
                {% for p in meetings %}
                  <br>{{p}}</br>
                {% endfor %}
                <a href="{% url 'view_meetings' project.slug %}"> Meeting Times </a>
            </div>

            <!-- TSR Tab -->
            <div class="tab-pane" id="tab_5">
                <div class="row">
                    <div class="col-md-12">
                    <h3 class="box-title">Assignments</h3>
                        <div class="box-body no-padding">
                            <table class="table table-striped">
                                <tbody>
                                    <tr>
                                        <th>Assigned</th>
                                        <th>Due</th>
                                        <th>Type</th>
                                        <th>Name</th>
                                        <th style="width:1%;">Number</th>
                                        <th>Description</th>
                                        <th> </th>
                                    </tr>
                                    {% for asg in assignments %}
                                    <tr>
                                        <td>{{asg.ass_date|date:'Y-m-d'}}</td>
                                        <td>
                                            {% if asg not in asg_completed %}
                                                {% if asg.due_date < today %}
                                                    <span class="tooltip2">
                                                       <span class="tooltiptext2">Assignment will be marked <strong>LATE</strong></span>
                                                       <span style="color:red;">{{asg.due_date|date:'Y-m-d'}}</span>
                                                    </span>
                                                {% else %}
                                                    {{asg.due_date|date:'Y-m-d'}}
                                                {% endif %}
                                            {% else %}
                                                {{asg.due_date|date:'Y-m-d'}}
                                            {% endif %}
                                        </td>
                                        <td>{{asg.ass_type}}</td>
                                        <td>{{asg.ass_name}}</td>
                                        <td style="text-align:center;">{{asg.ass_number}}</td>
                                        <td>{{asg.description}}</td>
                                        <td class="form-group"  style="text-align:center;">
                                        {% if asg in asg_completed %}
                                            {% comment %}
                                            <form action="{% url 'tsr_edit' project.slug asg.slug %}">
                                                <button class="btn btn-info btn-sm" type="submit" value="edit" name="edit">
                                                    <i class="fa fa-edit"></i> Edit
                                                </button>
                                            </form>
                                            {% endcomment %}
                                        {% else %}
                                            {% if request.user == scrum_master %}
                                                <form action="{% url 'tsr_update' project.slug asg.slug%}">
                                                    <button class="btn btn-success btn-sm" type="submit" value="scrum_master_form" name="scrum_master_form">
                                                        <i class="fa fa-plus"></i> Scrum Master
                                                    </button>
                                                </form>
                                            {% else %}
                                                <form action="{% url 'tsr_update' project.slug asg.slug%}">
                                                    <button class="btn btn-primary btn-sm" type="submit" value="normal_form" name="normal_form">
                                                        <i class="fa fa-plus"></i> Member Form
                                                    </button>
                                                </form>
                                            {% endif %}
                                        {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
            </div>

             <!-- View TSR Tab -->
            <div class="tab-pane" id="tab_6">
            <style>
                table {
                border-collapse: collapse;
                width: 100%;
              }
              th, td {
                text-align: left;
                padding: 8px;
              }
              th {
                background-color: #00A65A;
                color: white;
              }
            </style>
                {% for ass in assigned_tsrs %}
                <div class="box box-solid">
                  <div class="box-header with-border">
                    <h3 class="box-title">Evaluation #{{ ass.ass_number }}</h3>

                    <div class="box-tools">
                      <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                      </button>
                    </div>

                  </div>

                  <div class="box-body no-padding">
                   <ul class="nav nav-pills nav-stacked">

                            <table class="table table-hover">
                                       <tbody>
                                       <tr>
                                         <th style="width:1%;">Student</th>
                                         <th style="width:1%;">Evaluators</th>
                                         <th style="width:1%; text-align:center;">Contribution (%)</th>
                                         <th style="width:20%;">Positive Feedback</th>
                                         <th style="width:20%;">Negative Feedback</th>
                                         <th style="width:20%; border-left-color: #CCCCCC; border-left-style: solid;">Tasks Completed</th>
                                         <th style="width:20%;">Performance Assessment</th>
                                         <th style="width:20%;">Notes</th>
                                       </tr>
                                       <!--{{ tsrs|pprint }} see output_of_print_tsrs.txt-->
                                       <br><br>
                                       {% for m in members %}
                                           <tr style="border-top-color: #CCCCCC; border-top-style: solid;">
                                       {% for completed_tsrs in tsrs %}
                                       <!--{{ completed_tsrs|pprint }} see output_of_tsr_subcontainer.txt-->
                                       {% for eval in completed_tsrs.1 %}
                                                {% if eval.1.evaluatee == m %}
                                                {% if eval.2 == ass%}
                                                <td>
                                                     <a href="{% url 'profile' eval.1.evaluatee.username %}">
                                                    {{eval.1.evaluatee.email}}</a>
                                                </td>

                                                <td>
                                                    {% if eval.1.late %}
                                                        <span class="tooltip2">
                                                           <span class="tooltiptext2">Indicates Late Submission
                                                           </span>
                                                           <a href="{% url 'profile' eval.1.evaluator.username %}">

                                                           <span style="color:red;">{{eval.1.evaluator.email}}</span></a>
                                                        </span>
                                                    {% else %}
                                                    <a href="{% url 'profile' eval.1.evaluator.username %}">

                                                    {{eval.1.evaluator.email}}</a>
                                                    {% endif %}

                                               </td>

                                               <td style="text-align:center;">
                                                 {% if contribute_levels.high < eval.1.percent_contribution%}
                                                   <div style="color:blue">{{eval.1.percent_contribution}}</div>
                                                 {% else %}
                                                 {% if contribute_levels.low < eval.1.percent_contribution %}
                                                   <div style="color:green">{{eval.1.percent_contribution}}</div>
                                                 {%else%}
                                                   <div style="color:red">{{eval.1.percent_contribution}}</div>
                                                 {% endif %}
                                                 {% endif %}
                                                   <p>
                                               </td>

                                               <td style="text-align:justify;">
                                                 {{eval.1.positive_feedback}}
                                               </td>

                                               <td style="text-align:justify;">
                                                 {{eval.1.negative_feedback}}
                                               </td>

                                               <td style="text-align:justify; border-left-color: #CCCCCC; border-left-style: solid;">
                                                 {{eval.1.tasks_completed}}
                                               </td>
                                               <td style="text-align:justify;">
                                                 {{eval.1.performance_assessment}}
                                               </td>
                                               <td style="text-align:justify;">
                                                 {{eval.1.notes}}
                                               </td>
                                             </tr>
                                             {% endif %}
                                             {% endif %}
                                       {% endfor %}
                                       {% endfor %}
                                    {% endfor %}
                                       </tbody>
                           </table>
                   </ul>
                 </div>

                  <!-- /.box-body -->
                </div>
                <!-- /.box -->
              {% endfor %}


                <div class="box box-solid">
                  <div class="box-header with-border">
                    <h3 class="box-title">Average Contributions</h3>

                    <div class="box-tools">
                      <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                      </button>
                    </div>

                  </div>
                <div class="box-body no-padding">
                 <ul class="nav nav-pills nav-stacked">
                     <table class="table table-hover">
                     <tbody>
                       <tr>
                         <th>Student</th>
                         <th>Contribution (%)</th>
                       </tr>
                    {% for avg in avgs %}
                     <tr>
                       <td>{{ avg.0.email }}</td>
                       <td>
                         {% if contribute_levels.high < avg.1 %}
                             <div style="color:blue">{{avg.1}}</div>
                         {% else %}
                         {% if contribute_levels.low < avg.1 %}
                           <div style="color:green">{{avg.1}}</div>
                         {%else%}

                           <div style="color:red">{{avg.1}}</div>
                         {% endif %}
                         {% endif %}
                        </td>
                     </tr>
                     {% endfor %}
                     </tbody>
                   </table>
               </ul>
               </div>
               </div>


            </div>   

            <!-- ======================================================================================================================== -->
            <!-- TSR graphical analysis tab begin-->
            <!-- ======================================================================================================================== -->
			<style> 
				input[type=button], input[type=submit], input[type=reset] {
    			background-color: #4CAF50;
    			border: none;
    			color: white;
    			padding: 16px 32px;
    			text-decoration: none;
    			margin: 4px 2px;
    			cursor: pointer;
				}
			</style>
         
            <!-- Team health panel with student, average contribution, and status -->
                <!-- Student - displays the student's name. If they did not set their name, it displays their email/cruzid -->
                <!-- Average contribution - displays that student's average contribution as given by all members throughout the TSRs -->
                <!-- Status - displays "good", "warning", and "bad" in a gradiant from green to yellow to red respectively -->
            <!-- NLP panel with team status and the NLP simple output-->
            <div class="tab-pane" id="tab_9">
                <div class="box box-solid">
                    <div class="box-header with-border">
                        <h3 class="box-title">Team Health</h3>
                        <div class="box-tools">
                            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div>
                        <table>
                            <tbody>
                                <tr>
                                    <td style="width:30%">
                                        <table class="table table-hover" style="float: left;">
                                            <tbody>          
                                                <tr>
                                                    <th></th>
                                                    <th text-align:center;">Student</th>
                                                    <th text-align:center;">Average Contribution</th>
                                                    <th text-align:center;">Status</th>
                                                </tr>
                                                {% for member in members %}
                                                    <tr>
                                                        {% if member.profile.name != "" %}
                                                            <td id ="{{member.profile.name}}" style="width:5%"></td>
                                                            <td style="width:40%">
                                                                <a href="{% url 'profile' member.username %}">
                                                                    {{member.profile.name}}</a>
                                                            </td>
                                                        {% endif %}
                                                        {% if member.profile.name == "" %}
                                                            <td id ="{{member.profile.user}}" style="width:5%"></td>
                                                            <td style="width:40%">
                                                                <a href="{% url 'profile' member.username %}">
                                                                    {{member.profile.user}}</a>
                                                            </td>
                                                        {% endif %}
                                                        {% for analysis_ass in all_analysis %}
                                                            {% for analysis_piece in analysis_ass.1 %}
                                                                {% if analysis_piece.0.analysis_type == "Averages for all Evaluations" %}
                                                                {% if member == analysis_piece.0.associated_member %}
                                                                {% if analysis_piece.0.tsr_number == assigned_tsrs|length %}
                                                                    <td style="width:35%">
                                                                        {{analysis_piece.0.analysis_output}}
                                                                    </td>
                                                                    <!-- for widthratio x y 1, adjust x down to loosen lower bound for "good" -->
                                                                    {% widthratio 93 members|length 1 as ideal_average_value %}
                                                                    <!-- for widthratio ideal x y, fraction y/x of ideal gives lower bound for "warning" -->
                                                                    {% widthratio ideal_average_value 5 4 as modified_average_value %}
                                                                    {% if analysis_piece.0.analysis_output >= ideal_average_value %}
                                                                        <td style="width:25%">
                                                                            <div style="color:green">Good</div>
                                                                        </td>
                                                                    {% elif analysis_piece.0.analysis_output >= modified_average_value %}     
                                                                        <td style="width:25%">
                                                                            <div style="color:#ff8040">Warning</div>
                                                                        </td>
                                                                    {% else %}
                                                                        <td style="width:25%">
                                                                            <div style="color:red">Bad</div>
                                                                        </td>
                                                                    {% endif %}
                                                                {% endif %}
                                                                {% endif %}
                                                                {% endif %}
                                                            {% endfor %}
                                                        {% endfor %}
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </td>  
                                    <td style="width:15%">
                                        <table class="table table-hover" style="float: left;">
                                            <tbody>
                                                <tr>
                                                    <th id="team_status" text-align:center;">Team Status</th>
                                                </tr>
                                                <tr>
                                                    {% if health_flag == 0 %}
                                                    <td headers="team_status" style="color:chartreuse;width:40%;height:100px">
                                                        <div>No serious problems detected.</div>
                                                    </td>
                                                    {% endif %}
                                                    {% if health_flag == 1 %}
                                                    <td headers="team_status" style="color:orange;width:40%;height:100px">
                                                        <div>Suspicious behavior detected.</div>
                                                    </td>
                                                    {% endif %}
                                                    {% if health_flag == 2 %}
                                                    <td headers="team_status" style="color:red;width:40%;height:100px">
                                                        <div>Problems detected. Intervention recommended.</div>
                                                    </td>
                                                    {% endif %}
                                                </tr>   
                                            </tbody>
                                        </table>
                                    </td>   
                                </tr>                                    
                            </tbody>
                        </table>
                    </div>
                </div>
                
                
                
              <!-- TSR analysis charts-->
              <!-- Gives values to javascript for student_contribution_received.js to display the graphs -->
              <input type="hidden" id="tsr_numbers" name="variable" value="{{tsr_numbers}}">
              <input type="hidden" id="colors" value="{{colors_array}}">
              <input type="hidden" id="contributions_of_members" value="{{contributions_of_members}}">
              {% for tsr_number in tsr_numbers %}
              {% for member_average in member_averages %}
                <input type="hidden" id="{{tsr_number}}" name="variable" value="{{member_average}}">
              {% endfor %}
              {% endfor %}
                <input type="hidden" id="member_averages" name="variable" value="{{member_averages}}">
                <input type="hidden" id="other_member_contributions" name="variable" value="{{other_member_contributions}}">
                <table>
                    <tr>
                        <td>
                            <b>TSR Number</b>
                             <select onchange="update_local_barchart()" src="{% static 'js/student_contribution_received.js' %}" id="TSR #">
                                {% for tsr_number in tsr_numbers %}
                                <option value="{{tsr_number}}">{{tsr_number}}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td>
                            <b>Member:</b>
                            <select onchange="update_historical_barchart()" src="{% static 'js/student_contribution_received.js' %}" id="Member">
                                {% for member in member_names %}
                                    <option id="{{member}}">{{member}}</option>
                                {% endfor %}
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <th>Students' Contribution Scores Received</th>
                        <th>Historical Averages</th>
                    </tr>
                    <tr>
                        <td>
                            <div style="width: 75%;">
                                <canvas id="local_student_contribution" width="600px" height="600px" style="border-style: none solid #000000;"></canvas>
                            </div>
                        </td>
                        <td>
                            <div style="width: 75%;">
                                <canvas id="historical_student_contribution" width="600px" height="600px" style="border-style: none solid #000000;"></canvas>
                            </div>
                        </td>
                    </tr>
                </table>
				<br><br>

                <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.0.min.js"></script>
                <script type="text/javascript" src="{% static 'js/Chart.min.js' %}"></script>
                <script type="text/javascript" src="{% static 'js/student_contribution_received.js' %}"></script>
  


                <!-- TSR Flag Set Number-->
                <!-- Displays flags to the user ordered by student evaluator, analysis type, and then TSR number. -->
                <!-- The analysis types are from giving_outlier_scores(), tsr_word_count(), and similarity_of_eval_history(), respectively -->
                <b>TSR Flag Set Number</b>
                <select onchange="update_flag_table()" src="{% static 'js/flag_supression.js' %}" id="TSR FLAG #">
                        <option value="All">All</option>
                    {% for tsr_number in tsr_numbers reversed%}
                        <option value="{{tsr_number}}">{{tsr_number}}</option>
                    {% endfor %}
                </select>
               	<div id = "flag_table_div">
                	<table class = "table table-hover" id = "flag_table" >
                		<form action = '' method = 'POST'>
                			{% csrf_token %}
                			<thead>
                    			<tr>
                    				<th style="text-align:center;">TSR Number</th>
                    				<th style="text-align:center;">Student</th>
                        			<th style="text-align:center;">Flag Details</th>
                        			<th style=" text-align:center;">Suppress?</th>
                    			</tr>
                			</thead>
                    		<tbody>

                    			{% for m in members %}
                                {% for tsr_number in tsr_numbers%}
                   					{% for analysis_ass in all_analysis %}
                            			{% for analysis_piece in analysis_ass.1 %}
                                			{% if m == analysis_piece.0.associated_member %}
                                				{% if analysis_piece.0.flag_suppress == False %}
                                					{% if analysis_piece.0.flag_detail %}
                                                    {% if tsr_number == analysis_piece.0.tsr_number%}
                                						<tr style= "background-color:white";>
                                	    					<td style="text-align:center;">
                                            					{{analysis_piece.0.tsr_number}}
                                        					</td>
                                        					<td>
                                            					<a href="{% url 'profile' analysis_piece.0.associated_member.username %}">
                                            						{{analysis_piece.0.associated_member.email}}</a>
                                        					</td>
                                        					<td style="text-align:center;">
                                            					{{analysis_piece.0.flag_detail}}
                                        					</td>
                                                			<td style= "text-align:center;">
                                                				<input type="checkbox" name="MARK[]" value="{{analysis_piece.0.id}}" id="mark_suppressed_{{analysis_piece.0.id}}"> 
			                                                </td>
            			                				</tr>
                                                    {% endif %}
                        			    			{% endif %}
                            					{% endif %}
                                    		{% endif %}
                               			 {% endfor %}     
                            		{% endfor %}
                        		{% endfor %}
                                {% endfor %}
                    		</tbody>
					</table>
            		<span class="pull-right">
                        
                    	<input type="submit" name="unsuppress_flags" value="Reset Flags" onclick = "flag_table_reset(event);" src="{% static 'js/flag_supression.js' %}" >
                    	<input type="submit" name="mark_suppressed_confirmed" value="Submit" onclick = "flag_table_refresh_edit(event);" src="{% static 'js/flag_supression.js' %}">

                	</span>
                	<div class="clear"></div>

                            </form>

                </div>

                 <script src ="{%static 'js/flag_supression.js' %}" type = "text/javascript"></script>

            </div>

        <!-- ======================================================================================================================== -->
        <!-- TSR GRAPHICAL ANALYSIS TAB END -->
        <!-- ======================================================================================================================== -->


            <!-- /.tab-pane chat -->
            <div class="tab-pane" id="tab_7">
                  <!-- DIRECT CHAT SUCCESS -->
                  <div class="box box-success direct-chat direct-chat-success" >
                    <div class="box-header with-border">
                      <h3 class="box-title">Team Chat</h3>



                      <div class="box-tools pull-right">
                        <span data-toggle="tooltip" title="" class="badge bg-green" data-original-title="3 New Messages">3</span>

                        <button type="button" class="btn btn-box-tool" data-toggle="tooltip" title="" data-widget="chat-pane-toggle" data-original-title="Members">
                          <i class="fa fa-comments"></i></button>

                      </div>
                    </div>
                    <!-- /.box-header -->

                    <div class="box-body">
                      <!-- Conversations are loaded here -->
                      <div class="direct-chat-messages" style="height: 400px">
                        {% for msg in project_chat %}
                            {% if msg.author == request.user %}
                                <!-- Message  author pull to the right -->
                                <div class="direct-chat-msg right">
                                  <div class="direct-chat-info clearfix">
                                    <span class="direct-chat-name pull-right">{{msg.author.username}}</span>
                                    <span class="direct-chat-timestamp pull-left">{{msg.date}}</span>
                                  </div>
                                  <!-- /.direct-chat-info -->
                                  {% if msg.author.profile.avatar %}
                                    <img class="direct-chat-img pull-right" src="{{ msg.author.profile.avatar.url }}" alt="User Image">
                                  {% else %}
                                    <img class="direct-chat-img pull-right" src="https://www.gravatar.com/avatar/0cf665cbc2864084b988b0332fbebaae?s=90&amp;d=mm" alt="User Image">
                                  {% endif %}
                                  <div class="direct-chat-text" style="word-wrap: break-word;">
                                    {{msg.content}}
                                  </div>
                                  <!-- /.direct-chat-text -->
                                </div>
                                <!-- /.direct-chat-msg -->
                            {% else %}
                                <!-- Message non-author Default to the left -->
                                <div class="direct-chat-msg">
                                  <div class="direct-chat-info clearfix">
                                    <span class="direct-chat-name pull-left">{{msg.author.username}}</span>
                                    <span class="direct-chat-timestamp pull-right">{{msg.date}}</span>
                                  </div>
                                  <!-- /S.direct-chat-info -->

                                  {% if msg.author.profile.avatar %}
                                    <img class="direct-chat-img" src="{{ msg.author.profile.avatar.url }}" alt="User Image">
                                  {% else %}
                                    <img class="direct-chat-img" src="https://www.gravatar.com/avatar/0cf665cbc2864084b988b0332fbebaae?s=90&amp;d=mm" alt="User Image">
                                  {% endif %}
                                  <div class="direct-chat-text" style="word-wrap: break-word;">
                                    {{msg.content}}
                                  </div>
                                  <!-- /.direct-chat-text -->
                                </div>
                                <!-- /.direct-chat-msg -->
                            {% endif%}

                        {% empty %}
                            <div align="center"><font color="grey" size="3">No messages</font></div>
                        {% endfor %}

                      </div>
                      <!--/.direct-chat-messages-->

                      <!-- Load Members -->
                      <div class="direct-chat-contacts">
                        <ul class="contacts-list">
                            {% for mem in members %}
                                <li>
                                    <a href="{% url 'profile' mem.username %}">
                                      {% if mem.profile.avatar %}
                                        <img class="contacts-list-img" src="{{ mem.profile.avatar.url }}" alt="User Image">
                                      {% else %}
                                        <img class="contacts-list-img" src="https://www.gravatar.com/avatar/0cf665cbc2864084b988b0332fbebaae?s=90&amp;d=mm" alt="User Image">
                                      {% endif %}

                                      <div class="contacts-list-info">
                                            <span class="contacts-list-name">
                                              {{mem.username}}
                                            </span>
                                      </div>
                                    </a>
                                </li>
                            {% empty %}
                                <li>
                                    <a href="#">
                                      There are no current members on the team
                                    </a>
                                </li>
                            {% endfor %}
                            </a>
                          </li>
                        </ul>
                      </div>
                      <!-- /.Members List -->
                    </div>
                    <!-- /.box-body -->

                    <!-- box footer -->
                    <div class="box-footer">
                      <form action="#tab_7" method="POST">
                      {% csrf_token %}
                        <div class="input-group">
                          <input type="text" name="content" placeholder="Type Message ..." class="form-control">
                              <span class="input-group-btn">
                                <button type="submit" class="btn btn-success btn-flat">Send</button>
                              </span>
                        </div>
                      </form>
                    </div>
                    <!-- /.box-footer-->
                </div>
                <!--/.direct-chat -->
            </div>
            <!-- /.tab-pane chat -->
        </div>
        <!-- /.tab-content -->
    </div>
    <!-- nav-tabs-custom -->
</div>

<!-- Pending Members Box -->
{% if user in project_members or user == project.creator%}
<div class="box sm-box-solid collapsed-box">

    <div class="box-header with-border">
        <h6 class="box-title">Pending Requests to Join: ( {{ pending_count }} )</h6>
        <div class="box-tools">
            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i></button>
        </div>
    </div>

    <div class="box-body no-padding">
        <ul class="nav nav-pills nav-stacked">
            <table class="table table-striped">
                <tbody>
                <tr>
                  <th>Email Address</th>
                  <!-- <th style="width:50%">Request Date</th> -->
                  <th style="width: 40px"></th>
                  <th style="width: 40px"></th>
                </tr>
                {% for stud in pending_members %}
                    <tr>
                        <td> <a href="{% url 'profile' stud.username %}"> {{ stud.email }} </a> </td>
                        <!-- <td> Todo </td> -->
                        <td> <a href="{% url 'add_member' project.slug stud.username %}"> <button type="button" class="btn btn-block btn-primary btn-xs">Accept</button> </a></td>
                        <td> <a href="{% url 'reject_member' project.slug stud.username %}"><button type="button" class="btn btn-block btn-danger btn-xs">Reject</button> </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </ul>
    </div>

  <!-- /.box-body -->
</div>

{% endif %}


{% endblock content %}
